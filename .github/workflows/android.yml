name: Qt Android Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  QT_VERSION: 5.15.2
  JDK_VERSION: 17
  ANDROID_NDK_VERSION: 21.3.6528147
  ANDROID_SDK_VERSION: 6858149

jobs:
  build:
    name: Build Android APK
    runs-on: windows-latest

    steps:
    # 保持前序步骤不变...

    - name: Sign APK
      shell: cmd
      env:
        KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
        KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
        KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
      run: |
        jarsigner -verbose -sigalg SHA256withRSA -digestalg SHA-256 -keystore ${{ secrets.KEYSTORE_PATH }} -storepass $env:KEYSTORE_PASSWORD -keypass $env:KEY_PASSWORD android-build/build/outputs/apk/release/android-build-release-unsigned.apk $env:KEY_ALIAS

        zipalign -v 4 android-build/build/outputs/apk/release/android-build-release-unsigned.apk Knot-Signed.apk

    - name: Upload Artifact
      uses: actions/upload-artifact@v4  # 关键修复点
      with:
        name: Knot-Android
        path: |
          Knot-Signed.apk
          android-build/build/outputs/apk/release/*.apk
